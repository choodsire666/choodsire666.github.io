**导读：**在上一篇文章[《SpringCloud 应用在 Kubernetes 上的云上实践 - 开发篇》](https://www.yuque.com/xiankanpengyouquandisitiaodongtai/wewxb3/hw0mpc)中讲到可以通过两个工具，轻松地将一个 SpringCloud 应用从初始化到本地运行。本篇文章，我们将介绍如何将上一篇文章中提到的应用在云上跑起来。

### 
![](https://cdn.nlark.com/yuque/0/2020/gif/1169676/1601289240324-2cfef487-4989-4ce3-a96b-dbf38cde7d2d.gif#height=64&id=XUaa0&originHeight=10&originWidth=22&originalType=binary&ratio=1&rotation=0&showTitle=false&size=0&status=done&style=none&title=&width=140)
**初始化集群**

为了将应用运行在云端，首先我们需要一个 Kubernetes 集群，在 EDAS 中使用 Kubernetes 集群目前最快的方式，是将一个阿里云容器集群中的 Kubernetes 集群( ACK 集群 )，导入到 EDAS 中来。

如果还没有ACK集群的话，您可以通过以下两种方式来创建一个：

1. 直接进入容器服务的控制台进行创建；
2. 如果您已经有一个在云上建好的集群，或者有一个在其他 IDC 或友商中有的集群，也可以在容器服务这边通过“注册已有集群”的方式，导入到容器服务中来。

等到 Kubernetes 集群就绪之后，在 EDAS 上需要进行一次集群“导入”，导入方式如下图所示：

![](https://cdn.nlark.com/yuque/0/2020/jpeg/1169676/1601289240321-bb5efefe-a386-467d-b7ea-825b61fb23f8.jpeg?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_78%2Ctext_5rK554K45bCP5rOi%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10#averageHue=%23fefdfb&height=956&id=okwmp&originHeight=956&originWidth=2734&originalType=binary&ratio=1&rotation=0&showTitle=false&size=0&status=done&style=none&title=&width=2734)

在导入集群时，EDAS 会做以下操作：

- 初始化 EDAS 的集群控制器和相关资源，主要包含：基于开放云原生应用标准的 OAM Controller、日志采集的 Agent、监控链路中的 Arms 环境信息等；其中大部分控制器运行时不会占用用户集群的资源，而会运行在 EDAS 托管的一个管控集群中，由 EDAS 来负责维护；

 

- 根据用户的规划，划分好此集群与 EDAS 中命名空间的关系。EDAS 中的命名空间是用来隔离服务与配置的，简单的可以理解成开发、测试、线上这样的日常研发中的环境。集群导入的同时也确定了该 Kubernetes 集群是用于哪套环境。

### 
![](https://cdn.nlark.com/yuque/0/2020/gif/1169676/1601289240260-4f43b455-5276-441c-993a-26cbc17f4b8f.gif#height=64&id=KnFWh&originHeight=10&originWidth=22&originalType=binary&ratio=1&rotation=0&showTitle=false&size=0&status=done&style=none&title=&width=140)
**初始化应用**

在准备好集群之后，我们需要初始化一个云端的应用，进入 EDAS 中的创建应用的向导之后，选择刚刚创建的集群进行应用创建，在需要选择的应用应用运行环境处，会看到有 "自定义"、"Java" 、"Tomcat"、"EDAS Container" 四类，如下图所示：

![](https://cdn.nlark.com/yuque/0/2020/jpeg/1169676/1601289240332-a6d3781b-5b26-49f1-8264-f9093c4c0f45.jpeg?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_73%2Ctext_5rK554K45bCP5rOi%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10#averageHue=%23fafafa&height=1276&id=HqXf9&originHeight=1276&originWidth=2560&originalType=binary&ratio=1&rotation=0&showTitle=false&size=0&status=done&style=none&title=&width=2560)

这里需要特殊说明一下，因为一个应用一旦一开始确定了部署类型，以后将不能被修改，其中：

- **Java/Tomcat/EDAS Container 类型的的环境**：如果选择这中运行环境，文件上传之后，EDAS 将把文件与相应的基础镜像一起打成应用的镜像使用；

 

- **自定义环境**：选择镜像的运行环境之后，意味着每一次的部署均通过指定的自定义镜像进行部署，其中，自定义镜像需要满足一定的规范，具体内容可以参考阿里云帮助文档《制作应用容器 Docker 镜像》。其中核心的内容是以下两行代码：

```
# 继承 EDAS 的官方镜像
FROM apaas/edas
# 将文件下载至 /home/admin/app 中
ADD http://your.domain.com/file/location.jar /home/admin/app/
```

> **注**：EDAS 中的应用，运行时就是被 OAM 控制器管控下的 Kubernetes 的 Deployment，因此除了通过上述方式创建 EDAS 应用之外，EDAS 也能将集群中的 Deployment 读取出来，您可以将这些Deployment直接转成一个 EDAS 应用。这里如果有朋友对 EDAS 应用 与 Deployment 之间的转换感兴趣的话，我们在专门的章节中细讲。


![](https://cdn.nlark.com/yuque/0/2020/gif/1169676/1601289240338-b744b287-f9ab-4838-9771-b02e048c977b.gif#height=64&id=YO6FB&originHeight=10&originWidth=22&originalType=binary&ratio=1&rotation=0&showTitle=false&size=0&status=done&style=none&title=&width=140)
**通过 IDE 插件直接部署 Kubernetes 应用**

在初始化好应用之后，我们就能在开发时通过 IDE 将应用打包并直接部署上去了。和选择的 运行环境 有关，在插件中进行部署时，我们也会有相应的选项，如图：

![](https://cdn.nlark.com/yuque/0/2020/jpeg/1169676/1601289240296-75536fbd-5eaf-4e4b-948a-051781a931d7.jpeg?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_41%2Ctext_5rK554K45bCP5rOi%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10#averageHue=%233f4347&height=1228&id=BdKds&originHeight=1228&originWidth=1456&originalType=binary&ratio=1&rotation=0&showTitle=false&size=0&status=done&style=none&title=&width=1456)

如果是在开发环境中，为了提升开发效率，我们推荐使用非自定义镜像的方式用 IDE 插件进行部署，因为插件中文件上传比在控制台中上传的速度要快 3 倍以上，对于体积偏大的部署包来说非常好用！而且相比重新构建/推送镜像后再进行部署而言，直接提交war/jar的部署也要快很多。

> 关于如何在 IDE 插件中部署，可以在阿里云官方文档上搜索《使用 Cloud Toolkit 快速部署应用至 EDAS》进行详细了解。


### 
![](https://cdn.nlark.com/yuque/0/2020/gif/1169676/1601289240359-1236203e-a41a-4d8c-ac6b-a5985747f38b.gif#height=64&id=ryzGL&originHeight=10&originWidth=22&originalType=binary&ratio=1&rotation=0&showTitle=false&size=0&status=done&style=none&title=&width=140)
**结语及其后续**

本篇我们还是站在开发者的视角，介绍了如何将一个开发好的应用包部署到云上的 EDAS 应用中，在开发环境下，面对众多的部署 Kubernetes 集群的方式中，我们推荐的最佳方式是使用 war/jar 直接从插件中上传部署，在所有方式中这是最快的部署方式。接下来我们将介绍站在运维的角度，如何使用 EDAS 的其他工具来构建部署流程。
