# 基础篇Redis
## 问答环节
1.说说什么是 Redis?
2.Redis 可以用来干什么？
3.Redis 有哪些数据结构？
4.Redis 为什么快呢？
5.能说一下 I/O 多路复用吗？
6. Redis 为什么早期选择单线程？
7.Redis6.0 使用多线程是怎么回事?

**笔记来源：**[**黑马程序员Redis入门到实战教程，深度透析redis底层原理+redis分布式锁+企业解决方案**](https://www.bilibili.com/video/BV1cr4y1671t/?spm_id_from=333.337.search-card.all.click&vd_source=e8046ccbdc793e09a75eb61fe8e84a30)
# 1 认识NoSQL
## 1.1 什么是NoSQL

- NoSQL最常见的解释是"`non-relational`"， 很多人也说它是"**_Not Only SQL_**"
- NoSQL仅仅是一个概念，泛指**非关系型的数据库**
- 区别于关系数据库，它们不保证关系数据的ACID特性
- NoSQL是一项全新的数据库革命性运动，提倡运用非关系型的数据存储，相对于铺天盖地的关系型数据库运用，这一概念无疑是一种全新的思维的注入
- 常见的NoSQL数据库有：`Redis`、`MemCache`、`MongoDB`等
## 1.2 NoSQL与SQL的差异
|  | SQL | NoSQL |
| --- | --- | --- |
| 数据结构 | 结构化 | 非结构化 |
| 数据关联 | 关联的 | 无关联的 |
| 查询方式 | SQL查询 | 非SQL |
| 事务特性 | ACID | BASE |
| 存储方式 | 磁盘 | 内存 |
| 扩展性 | 垂直 | 水平 |
| 使用场景 | 
1. 数据结构固定
2. 相关业务对数据安全性、一致性要求较高
 | 
1. 数据结构不固定
2. 对一致性、安全性要求不高
3. 对性能要求
 |

# 2 认识Redis
> Redis诞生于2009年全称是Remote Dictionary Server，远程词典服务器，是一个基于内存的键值型NoSQL数据库。

**Redis的特征：**

- 键值（`key-value`）型，value支持多种不同数据结构，功能丰富
- 单线程，每个命令具备原子性
- 低延迟，速度快（基于内存、IO多路复用、良好的编码）。
- 支持数据持久化
- 支持主从集群、分片集群
- 支持多语言客户端
# 3 安装Redis
## 3.1 前置准备
> 本次安装Redis是基于Linux系统下安装的，因此需要一台Linux服务器或者虚拟机。
> Ps：由于提供的CentOS操作系统为mini版，因此需要自行配置网络，不会配置的请联系我，如果您使用的是自己购买的服务器，请提前开放`6379`端口，避免后续出现的莫名其妙的错误！

-  **虚拟机**：[VMware16](https://pan.baidu.com/s/1Zn13h9G7MtSgz-xdkQFeJg?pwd=1234) 
-  **操作系统**：[CentOS-7-x86_64-Minimal-1708](https://pan.baidu.com/s/1SiYip29cYqiNBqjGGV0JgA?pwd=1234) 
-  **Redis**：[redis-6.2.6.tar](https://pan.baidu.com/s/1hsoEz1NTCDCCWZmaiZrIgg?pwd=1234) 
-  **xShell及xFtp**：[https://www.xshell.com/zh/free-for-home-school/](https://www.xshell.com/zh/free-for-home-school/) 
## 3.2 安装Redis依赖
> Redis是基于C语言编写的，因此首先需要安装Redis所需要的gcc依赖

```shell
yum install -y gcc tcl
```
**安装成功如下图所示：**
![](https://cdn.nlark.com/yuque/0/2024/png/29688613/1711854079783-65b52582-007c-4c24-a52a-9254545c01ef.png#averageHue=%23131729&clientId=u14b18d86-bc29-4&id=hNb6O&originHeight=233&originWidth=1019&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u62f6633b-8ea7-4a60-9c47-e82ce097380&title=)
## 3.3 正式安装Redis
**① 将**`**redis-6.2.6.tar**`**上传至**`**/usr/local/src**`**目录**
![](https://cdn.nlark.com/yuque/0/2024/png/29688613/1711854079749-e3276490-0294-4a3a-90a8-d665b381bdbf.png#averageHue=%23ebe8e7&clientId=u14b18d86-bc29-4&id=HT4Su&originHeight=215&originWidth=595&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=ud65a78ab-3447-456f-843b-1ca3f45a72c&title=) 
**在xShell中**`**cd**`**到**`**/usr/local/src**`**目录执行以下命令进行解压操作** 
```shell
tar -xzf redis-6.2.6.tar.gz
```
 **解压成功后依次执行以下命令** 
```shell
cd redis-6.2.6
make
make install
```
 
**② 安装成功后打开/usr/local/bin目录（该目录为Redis默认的安装目录）**
![](https://cdn.nlark.com/yuque/0/2024/png/29688613/1711854079776-3ff574c9-5265-49f3-a126-4ff9972f4e98.png#averageHue=%23f3f1ef&clientId=u14b18d86-bc29-4&id=L5D06&originHeight=227&originWidth=670&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=uf05d51a6-0cf7-4867-aee6-dee08479364&title=) 
## 3.4 启动Redis
Redis的启动方式有很多种，例如：**前台启动**、**后台启动**、**开机自启**
### 3.4.1 前台启动
**不推荐**
> **这种启动属于前台启动，会阻塞整个会话窗口，窗口关闭或者按下**`**CTRL + C**`**则Redis停止。不推荐使用。**

**安装完成后，在任意目录输入**`**redis-server**`**命令即可启动Redis** 
```shell
redis-server
```
 **启动成功如下图所示**
![](https://cdn.nlark.com/yuque/0/2024/png/29688613/1711854079782-27cefeb8-41d2-4b0a-b2ca-07171269b0b5.png#averageHue=%23131729&clientId=u14b18d86-bc29-4&id=I13T7&originHeight=466&originWidth=1024&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u17f5c9b1-fe39-49a3-a501-6ca3df10f4d&title=) 
### 3.4.2 后台启动
**不推荐**
> **如果要让Redis以后台方式启动，则必须修改Redis配置文件，配置文件所在目录就是之前我们解压的安装包下**

**因为我们要修改配置文件，因此我们需要先将原文件备份一份** 
```shell
cd /usr/local/src/redis-6.2.6
```
  
**然后修改**`**redis.conf**`**文件中的一些配置** 
```properties
# 允许访问的地址，默认是127.0.0.1，会导致只能在本地访问。修改为0.0.0.0则可以在任意IP访问，生产环境不要设置为0.0.0.0
bind 0.0.0.0
# 守护进程，修改为yes后即可后台运行
daemonize yes 
# 密码，设置后访问Redis必须输入密码
requirepass 1325
```
 
**Redis其他常用配置** 
```properties
# 监听的端口
port 6379
# 工作目录，默认是当前目录，也就是运行redis-server时的命令，日志、持久化等文件会保存在这个目录
dir .
# 数据库数量，设置为1，代表只使用1个库，默认有16个库，编号0~15
databases 1
# 设置redis能够使用的最大内存
maxmemory 512mb
# 日志文件，默认为空，不记录日志，可以指定日志文件名
logfile "redis.log"
```
 
**启动Redis** 
```shell
# 进入redis安装目录 
cd /usr/local/src/redis-6.2.6
# 启动
redis-server redis.conf
```
 

-  **停止Redis服务** 
```shell
# 通过kill命令直接杀死进程
kill -9 redis进程id
```
### 3.4.3 开机自启
**推荐**
> **我们也可以通过配置来实现开机自启**

**①  首先，新建一个系统服务文件** 
```shell
vi /etc/systemd/system/redis.service
```
 
**②  将以下命令粘贴进去** 
```nginx
[Unit]
Description=redis-server
After=network.target

[Service]
Type=forking
ExecStart=/usr/local/bin/redis-server /usr/local/src/redis-6.2.6/redis.conf
PrivateTmp=true

[Install]
WantedBy=multi-user.target
```
 
**③  然后重载系统服务** 
```shell
systemctl daemon-reload
```
 
**④ 现在，我们可以用下面这组命令来操作redis了** 
```shell
# 启动
systemctl start redis
# 停止
systemctl stop redis
# 重启
systemctl restart redis
# 查看状态
systemctl status redis
```
 
**⑤  执行下面的命令，可以让redis开机自启** 
```shell
systemctl enable redis
```
## 3.5 docker启动redis

1. 下载镜像
```java
docker pull redis
```
![image.png](https://cdn.nlark.com/yuque/0/2022/png/22334924/1666165433180-bdd896e2-fdbc-4eac-bccc-8fabaaed7ccb.png#averageHue=%23efefef&clientId=ue3768dcb-f79a-4&errorMessage=unknown%20error&from=paste&height=164&id=uce558407&originHeight=171&originWidth=631&originalType=binary&ratio=1&rotation=0&showTitle=false&size=20939&status=error&style=none&taskId=ueaadfc1b-7908-44eb-a017-1766dd86914&title=&width=606.5)

2. 启动docker容器
```java
docker run --name myredis -i -t -p 6379:6379 redis:latest
```
```java
docker run --name myredis4 -p 6379:6379 -v /Users/admin/Desktop/myredis/data:/data -v /Users/admin/Desktop/myredis/conf/redis.conf:/etc/redis/config/redis.config --restart=always -itd redis --appendonly yes

// -v：挂载的意思
// /Users/admin/Desktop/myredis/data 挂载的路径
// /Users/admin/Desktop/myredis/conf/redis.conf  也是挂载的路径
```
![image.png](https://cdn.nlark.com/yuque/0/2022/png/22334924/1666165498762-8d253661-8d08-4129-bdb0-c929f4b98f9f.png#averageHue=%23f8f8f8&clientId=ue3768dcb-f79a-4&errorMessage=unknown%20error&from=paste&height=212&id=ud009c2df&originHeight=318&originWidth=1184&originalType=binary&ratio=1&rotation=0&showTitle=false&size=39777&status=error&style=none&taskId=uf36888af-e118-4cd3-9f05-4f4752931fc&title=&width=789)

3. 进入容器
```java
docker exec -it 4ddcd2e80eac /bin/bash
```
![image.png](https://cdn.nlark.com/yuque/0/2022/png/22334924/1666165571930-a99f0643-716c-4ec0-bb33-fe63454387c1.png#averageHue=%23f3f3f3&clientId=ue3768dcb-f79a-4&errorMessage=unknown%20error&from=paste&height=136&id=ua0301432&originHeight=154&originWidth=716&originalType=binary&ratio=1&rotation=0&showTitle=false&size=10476&status=error&style=none&taskId=ud52ede6a-4dca-42fe-b5b6-c8c152bbcc8&title=&width=634)

4. 连接redis
```java
redis-cli -h 127.0.0.1 -p 6379
```
![image.png](https://cdn.nlark.com/yuque/0/2022/png/22334924/1666165597899-50cd8a64-a47e-4b89-81d9-6c04c760dd8c.png#averageHue=%23f5f5f5&clientId=ue3768dcb-f79a-4&errorMessage=unknown%20error&from=paste&height=214&id=u190b60e0&originHeight=156&originWidth=510&originalType=binary&ratio=1&rotation=0&showTitle=false&size=8254&status=error&style=none&taskId=ud5d3dea7-5571-426b-bb58-04042317be9&title=&width=701)
然后就可以愉快的进行redis命令操作了

