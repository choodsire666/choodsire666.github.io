**笔记来源：**[**黑马程序员 MySQL数据库入门到精通，从mysql安装到mysql高级、mysql优化全囊括**](https://www.bilibili.com/video/BV1Kr4y1i7ru/?spm_id_from=333.337.search-card.all.click&vd_source=e8046ccbdc793e09a75eb61fe8e84a30)
## 1 介绍
视图（View）是一种虚拟存在的表。视图中的数据并不在数据库中实际存在，行和列数据来自定义视图的查询中使用的表，并且是在使用视图时动态生成的。
通俗的讲，视图只保存了查询的SQL逻辑，不保存查询结果。所以我们在创建视图的时候，主要的工作就落在创建这条SQL查询语句上。
## 2 语法
**创建**
```sql
CREATE [OR REPLACE] VIEW 视图名称[(列名列表)] AS SELECT语句 [ WITH [ CASCADED | LOCAL ] CHECK OPTION ]
```

**查询**
```sql
SHOW CREATE VIEW 视图名称; --查看创建视图语句
SELECT * FROM 视图名称 ...... ; --查看视图数据
```

**修改**
```sql
--  方式一
CREATE [OR REPLACE] VIEW 视图名称[(列名列表)] AS SELECT语句 [ WITH [ CASCADED | LOCAL ] CHECK OPTION ]

-- 方式二
ALTER VIEW 视图名称[(列名列表)] AS SELECT语句 [ WITH [ CASCADED | LOCAL ] CHECK OPTION ]
```

**删除**
```sql
DROP VIEW [IF EXISTS] 视图名称 [,视图名称] ...
```

演示示例：
```plsql
-- 创建视图 
create or replace view stu_v_1 as select id,name from student where id <= 10; 

-- 查询视图 
show create view stu_v_1;

select * from stu_v_1; 
select * from stu_v_1 where id < 3; 

-- 修改视图 
create or replace view stu_v_1 as select id,name,no from student where id <= 10; 
alter view stu_v_1 as select id,name from student where id <= 10;

-- 删除视图 
drop view if exists stu_v_1;
```

上述我们演示了，视图应该如何创建、查询、修改、删除，那么我们能不能通过视图来插入、更新数据呢？ 接下来，做一个测试。
```plsql
create or replace view stu_v_1 as select id,name from student where id <= 10 ; 
select * from stu_v_1; 
insert into stu_v_1 values(6,'Tom'); 
insert into stu_v_1 values(17,'Tom22');
```
执行上述的SQL，我们会发现，id为6和17的数据都是可以成功插入的。 但是我们执行查询，查询出来的数据，却没有id为17的记录。
![](https://cdn.nlark.com/yuque/0/2024/png/29688613/1710389573742-b5d7f860-9106-4691-8e7d-bbf2dc48b8f8.png#averageHue=%23f9f9f8&clientId=u5cb2e436-58db-4&id=SoEBs&originHeight=379&originWidth=576&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u1a93d01c-a05a-4dd1-a6a6-c6b26fefd7e&title=)
因为我们在创建视图的时候，指定的条件为 id<=10, id为17的数据，是不符合条件的，所以没有查询出来，但是这条数据确实是已经成功的插入到了基表中。
如果我们定义视图时，如果指定了条件，然后我们在插入、修改、删除数据时，是否可以做到必须满足条件才能操作，否则不能够操作呢？ 答案是可以的，这就需要借助于视图的检查选项了。
## 3 检查选项
当使用`WITH CHECK OPTION`子句创建视图时，MySQL会通过视图检查正在更改的每个行，例如插入，更新，删除，以使其符合视图的定义。 MySQL允许基于另一个视图创建视图，它还会检查依赖视图中的规则以保持一致性。为了确定检查的范围，mysql提供了两个选项： CASCADED 和 LOCAL，默认值为 CASCADED 。

1.  CASCADED：级联。
比如，v2视图是基于v1视图的，如果在v2视图创建的时候指定了检查选项为 cascaded，但是v1视图创建时未指定检查选项。 则在执行检查时，不仅会检查v2，还会级联检查v2的关联视图v1。
![](https://cdn.nlark.com/yuque/0/2024/png/29688613/1710389573976-91dd024f-7b36-435a-ba9a-56cb4a941482.png#averageHue=%23f9efe6&clientId=u5cb2e436-58db-4&id=wONaS&originHeight=287&originWidth=770&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u89213c65-0fff-4d5b-9cd0-b0d5d53b04e&title=)
2. LOCAL：本地。
比如，v2视图是基于v1视图的，如果在v2视图创建的时候指定了检查选项为 local ，但是v1视图创建时未指定检查选项。 则在执行检查时，知会检查v2，不会检查v2的关联视图v1。
![](https://cdn.nlark.com/yuque/0/2024/png/29688613/1710389573952-8c55ba12-7cdf-48c3-bd61-8a16cb8ce7fc.png#averageHue=%23faf0e8&clientId=u5cb2e436-58db-4&id=K2D5h&originHeight=282&originWidth=760&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u0798687d-efe3-4e94-8d45-5cd8991a862&title=)
## 4 视图的更新
要使视图可更新，视图中的行与基础表中的行之间必须存在一对一的关系。如果视图包含以下任何一项，则该视图不可更新：

- A. 聚合函数或窗口函数（SUM()、 MIN()、 MAX()、 COUNT()等）
- B. DISTINCT
- C. GROUP BY
- D. HAVING
- E. UNION 或者 UNION ALL

示例演示:
```plsql
create view stu_v_count as select count(*) from student;
```
上述的视图中，就只有一个单行单列的数据，如果我们对这个视图进行更新或插入的，将会报错。
```plsql
insert into stu_v_count values(10);
```
![](https://cdn.nlark.com/yuque/0/2024/png/29688613/1710389573793-10bc9a68-ae0e-4eb9-9af5-e8c05b592e62.png#averageHue=%23fcefec&clientId=u5cb2e436-58db-4&id=anftz&originHeight=73&originWidth=1206&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u0593b6e2-beb8-46b6-bdfc-476681a18fc&title=)
## 5 视图作用

- 简单：视图不仅可以简化用户对数据的理解，也可以简化他们的操作。那些被经常使用的查询可以被定义为视图，从而使得用户不必为以后的操作每次指定全部的条件。
- 安全：数据库可以授权，但不能授权到数据库特定行和特定的列上。通过视图用户只能查询和修改他们所能见到的数据
- 数据独立：视图可帮助用户屏蔽真实表结构变化带来的影响。
## 6 案例

1. 为了保证数据库表的安全性，开发人员在操作tb_user表时，只能看到的用户的基本字段，屏蔽手机号和邮箱两个字段。
```plsql
create view tb_user_view as select id,name,profession,age,gender,status,createtime from tb_user; 
select * from tb_user_view;
```

2. 查询每个学生所选修的课程（三张表联查），这个功能在很多的业务中都有使用到，为了简化操作，定义一个视图。
```plsql
create view tb_stu_course_view as select s.name student_name , s.no student_no , c.name course_name from student s, student_course sc , course c where s.id = sc.studentid and sc.courseid = c.id; 
select * from tb_stu_course_view;
```
